<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="mapper.packReview">
		<select id="selectPackReview" parameterType="map" resultType="packReviewVO">
		SELECT 
			r.packageNum, 
	        p.packageName,
	        CONCAT(LEFT(u.userId, CHAR_LENGTH(u.userId) - 3), '***') AS userId,
	        r.pkRating, 
	        r.pkReviewContent AS pkContent, 
	        r.createdAt,
	        r.pkReviewImgUrl AS imgUrl
	    FROM packReview r
	    JOIN package p ON r.packageNum = p.packageNum
	    JOIN user u ON r.userNum = u.userNum
	    WHERE r.packageNum = #{packageNum}
	    ORDER BY r.createdAt DESC
	    LIMIT #{start}, #{pageSize}
	</select>
	<select id="countProdReview" resultType="Integer" parameterType="long">
	    SELECT COUNT(*) FROM packReview WHERE packageNum = #{packageNum}
	</select>
	</mapper>